<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login - Restaurante Liz</title>
  <link rel="stylesheet" href="login.css">
</head>

<body>
  <div id="app">
    <div class="container">
      <header class="welcome">
        <a href="/frontend/BIenvenida/bienvenida.html"></a>
        <h1>INICIO DE SESION "CLIENTES"</h1>
        <h2 class="restaurant-title">RESTAURANTE LIZ</h2>
      </header>
      <main class="login-container">
        <div class="logo">
          <img src="logo_restaurante.png" alt="Logo Restaurante Liz" style="border-radius: 100px;">
        </div>
        <form class="login-form">
          <fieldset>
            <legend>INGRESAR</legend>

            <label for="email">Correo Electrónico:</label>
            <input type="email" id="email" placeholder="Correo Electrónico">

            <label for="password">Código:</label>
            <input type="password" id="password" placeholder="Contraseña">
            <a href="../RestablecerContrasenaUsuarios/nuevo_codigo.html">¿Olvidaste tu contraseña?</a>
            <button id="login-btn" @click="comprobar()">INGRESAR</button>
            <a href="../crearCuenta/crear_cuenta.html">Crear cuenta</a>
          </fieldset>
        </form>
      </main>
    </div>
  </div>
</body>

<script>
  document.getElementById('reset-password-btn').addEventListener('click', function(event) {
      event.preventDefault(); 
      alert('Se ha enviado un mensaje a caminlo el genrente le mandara su contraesña.');
  });
  </script>
  

<script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.20.0/axios.js"
  integrity="sha512-nqIFZC8560+CqHgXKez61MI0f9XSTKLkm0zFVm/99Wt0jSTZ7yeeYwbzyl0SGn/s8Mulbdw+ScCG41hmO2+FKw=="
  crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10.0.2/dist/sweetalert2.all.min.js"></script>

<script>
  let url = 'http://localhost:4000/users';
  let url2 = 'http://localhost:4000/regis';
  let contad = 0;
  new Vue({
    el: '#app',
    vuetify: new Vuetify(),
    data() {
      return {
        userss: [],
        users: {
          id: null,
          nombre: '',
          correo: '',
          contrasena: '',
          tipo: '',
          contador: ''
        },
        regis: [],
        reg: {
          id: null,
          id_usuario: '',
          fecha_registro: ''
        }
      }
    },
    created() {
      this.mostrar()
    },
    methods: {
      //MÉTODOS PARA EL CRUD
      mostrar: function () {
        axios.get(url)
          .then(response => {
            this.userss = response.data;

          })
      },
      crear: function () {
        let parametros = { nombre: this.users.nombre, correo: this.users.correo, contrasena: this.users.contrasena, tipo: this.users.tipo, contador: this.users.contador };
        axios.post(url, parametros)
          .then(response => {
            this.mostrar();
          });
        this.users.nombre = "";
        this.users.correo = "";
        this.users.contrasena = "";
      },
      editar: function () {
        let parametros = { nombre: this.users.nombre, correo: this.users.correo, contrasena: this.users.contrasena, tipo: this.users.tipo, contador: this.users.contador };
        //console.log(parametros);                   
        axios.put(url + "/" + this.users.id, parametros)
          .then(response => {
            this.mostrar();
          })
          .catch(error => {
            console.log(error);
          });
      },
      borrar: function (id) {
        Swal.fire({
          title: '¿Confirma eliminar el registro?',
          confirmButtonText: `Confirmar`,
          showCancelButton: true,
        }).then((result) => {
          if (result.isConfirmed) {
            //procedimiento borrar
            axios.delete(url + "/" + id)
              .then(response => {
                this.mostrar();
              });
            Swal.fire('¡Eliminado!', '', 'success')
          } else if (result.isDenied) {
          }
        });
      },

      comprobar: function () {
        event.preventDefault();
        var email = document.getElementById("email").value;
        var password = document.getElementById("password").value;
        var flagin = false;
        var idus;
        this.userss.forEach(usuario => {
          if (password === usuario.contrasena && email === usuario.correo) {
            flagin = true;
            idus=usuario.id;
          }
        });
        if (contad<3) {
          if (flagin) {
            var fechaActual = new Date();

            var dia = fechaActual.getDate();
            var mes = fechaActual.getMonth() + 1;
            var año = fechaActual.getFullYear();

            var fechaFormateada = dia + '/' + mes + '/' + año;
            let parametros = { id_usuario: idus, fecha_registro: fechaFormateada };
            axios.post(url2, parametros)
              .then(response => {
                
              });
            window.location.href = "../../MenuCliente/menu.html";
          } else {
            contad=contad+1;
            alert("Credenciales incorrectas. Por favor, inténtalo de nuevo.");

          }
        }else{
          alert("Intentos superados. Intente mas tarde");
        }
        
      },
    }
  });
</script>

</html>